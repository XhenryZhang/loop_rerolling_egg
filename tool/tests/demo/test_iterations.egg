(include "../tool/maki_decomp.egg")

; test egraph state explosion -- happens for any type of circuit, not just adders
(push)

(define two-bit-add
    (Concat (Concat (Or (And (Wire (W "b1")) (Wire (W "a1"))) (And (Or (And (Wire (W "b0")) (Wire (W "a0"))) (And (Wire (W "cin")) (Xor (Wire (W "b0")) (Wire (W "a0"))))) (Xor (Wire (W "b1")) (Wire (W "a1"))))) ; carry out
            (Xor (Xor (Wire (W "b1")) (Wire (W "a1"))) (Or (And (Wire (W "b0")) (Wire (W "a0"))) (And (Wire (W "cin")) (Xor (Wire (W "b0")) (Wire (W "a0"))))))) ; 1st bit of sum
            (Xor (Xor (Wire (W "b0")) (Wire (W "a0"))) (Wire (W "cin")))) ; 0th bit of sum
)

;(define generic-circuit-3
      ; (And (Or (And (Wire (W "b4")) (Wire (W "a4"))) (And (Wire (W "cin4")) (Xor (Wire (W "b4")) (Wire (W "a4"))))) (Xor (Xor (Wire (W "b4")) (Wire (W "a4"))) (Wire (W "cin4")))))
(define generic-circuit
      (And (Or (And (Wire (W "b4")) (Wire (W "a4"))) (And (Wire (W "cin4")) (Xor (Wire (W "b4")) (Wire (W "a4"))))) (Xor (Xor (Wire (W "b4")) (Wire (W "a4"))) (Wire (W "cin4")))))

; (run 15)
; (run 11)
(run 6)
; (run 5)
(extract generic-circuit)
(extract two-bit-add)
(extract (wires-in-wexp generic-circuit))
(pop)